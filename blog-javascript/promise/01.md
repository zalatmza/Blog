# 实现Promise

## 一、简单版实现
### 基本用法
```js
const promise = new Promise((resolve, reject) => {
  if (xxx) {
    resolve()
  } else {
    reject()
  }
})

promise.then(a => {},e => {})
```

### 实现
```js
class Promise {
  value = undefined
  status = 'pending'
  
  successCb = () => null
  errorCb = () => null
  
  constructor (execCb) {
    const resolve = (value) => {
      if (this.status !== 'pending') { return }
      this.status = 'resolved'
      this.value = value
      // 这里是为了让successCb在promise.then后执行，用settimeout模拟
      setTimeout(() => {
        this.successCb(this.value)
      }, 0)
    }
    
    const reject = (error) => {
      if (this.status !== 'pending') { return }
      this.status = 'rejected'
      setTimeout(() => {
        this.errorCb(error)
      }, 0)
    }
    
    try {
      execCb(resolve, reject)
    } catch (e) {
      reject(e)
    }
  }
  
  then (resolveCb, rejectCb) {
    this.successCb = resolveCb
    this.errorCb = rejectCb
  }
}
```

### 测试
```js
const promise = new Promise((resolve, reject) => {
  console.log(1)
  resolve('resolve')
  console.log(2)
})

promise.then(a => {
  console.log(a)
}, e => {
  console.log(e)
})
```

输出
```
1
2
resolve
```